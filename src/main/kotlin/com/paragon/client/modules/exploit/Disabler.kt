package com.paragon.client.modules.exploit

import com.paragon.backend.event.events.net.PacketEvent
import com.paragon.backend.module.Category
import com.paragon.backend.module.Module
import com.paragon.mixin.duck.IClientPlayerInteractionManager
import com.paragon.util.mc
import me.bush.eventbus.annotation.EventListener
import net.minecraft.network.packet.c2s.play.KeepAliveC2SPacket
import net.minecraft.network.packet.c2s.play.PlayerInteractBlockC2SPacket
import net.minecraft.network.packet.c2s.play.PlayerMoveC2SPacket
import net.minecraft.util.Hand
import net.minecraft.util.hit.BlockHitResult
import net.minecraft.util.math.Direction
import net.minecraft.util.math.Vec3d

/**
 * @author aesthetical
 * @since 04/09/23
 */
object Disabler : Module("Disabler", "Disables anticheats", Category.EXPLOIT) {

    @EventListener
    fun onPacketOutbound(event: PacketEvent.Outbound) {
        if (event.packet is KeepAliveC2SPacket) {
            event.cancel()
        } else if (event.packet is PlayerMoveC2SPacket) {
            (mc.interactionManager as IClientPlayerInteractionManager).hookSendSequencedPacket(mc.world) { seq ->
                return@hookSendSequencedPacket PlayerInteractBlockC2SPacket(
                        Hand.MAIN_HAND,
                        BlockHitResult(Vec3d.ZERO, Direction.DOWN, mc.player!!.blockPos, false),
                        seq)
            }
        }
    }
}