package com.paragon.client.modules.exploit

import com.paragon.backend.event.events.net.PacketEvent
import com.paragon.backend.module.Category
import com.paragon.backend.module.Module
import com.paragon.util.mc
import me.bush.eventbus.annotation.EventListener
import net.minecraft.item.Items
import net.minecraft.network.packet.c2s.play.ClientCommandC2SPacket
import net.minecraft.network.packet.c2s.play.PlayerActionC2SPacket
import net.minecraft.network.packet.c2s.play.PlayerMoveC2SPacket.Full

/**
 * @author surge
 * @since 27/02/2023
 */
object FastProjectile : Module("Fast Projectile", "Manipulate the velocity of bows to give you a higher damage output", Category.EXPLOIT) {
    private val shots by int("Shots", 10, 1, 1..300, "How many shots to take")

    @EventListener
    fun onOutbound(event: PacketEvent.Outbound) {
        if (event.packet is PlayerActionC2SPacket && event.packet.action == PlayerActionC2SPacket.Action.RELEASE_USE_ITEM && mc.player!!.mainHandStack.item == Items.BOW) {
            mc.player!!.networkHandler!!.sendPacket(ClientCommandC2SPacket(mc.player, ClientCommandC2SPacket.Mode.START_SPRINTING))

            for (i in 0..shots) {
                mc.player!!.networkHandler!!.sendPacket(Full(mc.player!!.x, mc.player!!.y + 1e-10, mc.player!!.z, mc.player!!.yaw, mc.player!!.pitch, false))
                mc.player!!.networkHandler!!.sendPacket(Full(mc.player!!.x, mc.player!!.y - 1e-10, mc.player!!.z, mc.player!!.yaw, mc.player!!.pitch, true))
            }
        }
    }

}